(()=>{"use strict";const t=globalThis;t.__sasAuthPopover=t.__sasAuthPopover||void 0;class e extends class{constructor(t,e){this._closed=!0,this._url=t,this._title=e}open(){var t;if(this._closed=!this.popup||this.popup.closed,__sasAuthPopover&&__sasAuthPopover===this.popup&&!this._closed)return void(null===(t=this.popup)||void 0===t||t.focus());const e=window.outerHeight/2+window.screenY-300,s=window.outerWidth/2+window.screenX-350,i=window.open(this._url,this._title,`width=700,height=600,top=${e},left=${s}`);i&&!i.closed&&(this._closed=!1,this.popup=i,__sasAuthPopover=i)}close(){__sasAuthPopover===this.popup&&function(){const t=__sasAuthPopover;t&&(__sasAuthPopover=void 0,t.close())}()}}{_rejectPromise(){var t;this._resolutionPromise&&(this._messageCb&&window.removeEventListener("message",this._messageCb),clearInterval(this._intervalId),this._messageCb=void 0,this._resolutionPromise=void 0,this._resolve=void 0,null===(t=this._reject)||void 0===t||t.call(this),this._reject=void 0)}_acceptPromise(){var t;this._resolutionPromise&&(this._messageCb&&window.removeEventListener("message",this._messageCb),clearInterval(this._intervalId),this._messageCb=void 0,this._resolutionPromise=void 0,this._reject=void 0,null===(t=this._resolve)||void 0===t||t.call(this),this._resolve=void 0)}open(){super.open(),this._closed||(this._resolutionPromise=new Promise(((t,e)=>{this._resolve=t,this._reject=e,this._messageCb=t=>{-1!==this._url.indexOf(t.origin)&&t.data&&t.data.logonStatus&&this._acceptPromise()},window.addEventListener("message",this._messageCb),this._intervalId=window.setInterval((()=>{var t;null===(t=this.popup)||void 0===t||t.postMessage("register","*")}),250)})))}waitForMessage(){return this._resolutionPromise?this._resolutionPromise:Promise.reject()}close(){super.close(),this._rejectPromise()}}const s=new Map;class i{constructor(t){this._config=t,this._server=t.url,t.guest&&s.set(this._config.url,Object.assign(Object.assign({},this._getAuthenticationInfo()),{guestEnabled:!0}))}_getAuthenticationInfo(){var t;return null!==(t=s.get(this._config.url))&&void 0!==t?t:{authenticated:void 0,guestEnabled:!1}}_setStoreStatus(t){const e=this._getAuthenticationInfo();s.set(this._config.url,Object.assign(Object.assign({},e),{authenticated:t}))}async _checkEndpoint(){try{const t=await fetch(`${this._server}/SASVisualAnalytics/logon/index.html`,{credentials:"include"});if((await t.text()).includes("data-report-sas-auth-success"))return this._setStoreStatus(!0),!0;throw new Error("Not authenticated.")}catch(t){if(this._getAuthenticationInfo().guestEnabled){const t=await async function(t){if(!(await fetch(`${t}/reports/?sso_guest=true`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include"})).ok)throw new Error("invalid logon response")}(this._server).then((()=>!0),(()=>!1));return this._setStoreStatus(t),t}}return this._setStoreStatus(!1),!1}async checkAuthenticated(){var t;if(!(null!==(t=this._getAuthenticationInfo().authenticated)&&void 0!==t?t:await this._checkEndpoint()))throw`Not authenticated on ${this._server}`}async loginPopup(){return new Promise((async(t,s)=>{try{await function(t,s){const i=new e(t,"");return i.open(),i.waitForMessage().then((()=>i.close()))}(`${this._server}/SASVisualAnalytics/logon/index.html`),t()}catch(t){s(`${this._server} failed to log in`)}}))}async logout(){if(!(await fetch(`${this._server}/SASLogon/logout.do`,{credentials:"include",headers:{"X-Requested-With":"XMLHttpRequest"}})).ok)throw new Error("Failed to logout.")}invalidateCache(){this._setStoreStatus(void 0)}}globalThis.sasAuthBrowser={createCookieAuthenticationCredential:t=>new i(t)}})();